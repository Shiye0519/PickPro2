import{_ as J,r as l,j as S,k as P,c,h as M,b as x,a,f as h,d as g,t as R,F as q,e as K,n as j,l as Q,v as X,o as d}from"./index-BkhVFK_G.js";import{F as Z}from"./FeatureSidebar-X2OrkaVm.js";const Y={class:"trend-page"},G={class:"container"},tt={class:"main-content"},et={class:"parameter-panel"},at={class:"form-actions"},st=["disabled"],ot={key:0,class:"fas fa-spinner fa-spin"},rt={class:"result-content"},nt={key:0,class:"placeholder-text"},lt={key:1,class:"analysis-output"},it={class:"output-header"},ct={class:"header-left"},dt={class:"timestamp"},ut=["innerHTML"],vt={key:0,class:"feedback-section"},ft={class:"feedback-title"},pt={class:"feedback-buttons"},bt={key:0,class:"feedback-comment"},mt={key:1,class:"feedback-thanks"},gt="https://api.coze.cn/v1/workflow/run",yt="pat_hWPutau3CRQrAOS48iXuQH0aDsIriuczPJkZKuSPejqq0X2w1I1xU4VtxeeKio2a",ht={__name:"TrendView",setup(kt){const r=l({categoryL1:"",categoryL2:"",categoryL3:"",categoryL4:"",priceRange:"",style_features:""}),$=["风衣","汉服","牛仔裤","皮草","皮衣","时尚套装","休闲裤","休闲运动套装","秀禾服","羽绒服","Polo衫","T恤","背心","衬衫","大码上装","大码下装","短裤","短外套","防晒服","工装制服","夹克","马甲","毛呢大衣","棉裤","棉衣","牛仔衬衫","牛仔外套","皮裤","商务正装西服","设计师/潮牌男装","时尚防晒服","唐装","卫裤","卫衣","西服","西裤","休闲西服","羊毛衫","羊绒背心","羊绒开衫","羊绒衫","羊绒套衫","羽绒裤","羽绒马甲","针织衫","中老年上装","中老年套装","中老年下装","中山装"],O=["POLO衫","T恤","半身裙","背心吊带","衬衫","短外套","风衣","连衣裙","毛衣","毛针织衫","牛仔裤","派克服","皮衣","时尚防晒服","卫裤","休闲裤","羊绒衫","羽绒服","中老年女装","打底裤","大码连衣裙","大码女装","汉服","蕾丝衫/雪纺衫","马夹","毛呢外套","棉衣/棉服","抹胸","皮草","旗袍","时尚套装","唐装/中式服装裙子","唐装/中式服装上衣","卫衣/绒衫","西装","休闲运动套装","秀禾服","打底服","大码衬衫","大码牛仔裤","大衣","短裤","礼服_晚装","连体衣/裤","连体衣裤","马甲","棉裤/羽绒裤","棉衣_棉服","设计师/潮牌女装","天然皮草","卫衣_绒衫","西服","西服套装","西装裤/正装裤","羊毛衫","羊绒大衣","真丝上装"],k=l([]);S(()=>r.value.categoryL1,s=>{r.value.categoryL2="",s==="男装"?k.value=$:s==="女装"?k.value=O:k.value=[]});const f=l(!1),n=l(""),T=l(null),E=async s=>{if(!f.value)try{f.value=!0,T.value=null,n.value="正在分析中...",r.value={categoryL1:"",categoryL2:"",categoryL3:"",categoryL4:"",priceRange:"",style_features:""};const t={workflow_id:"7475255134705319987",parameters:{categoryL1:r.value.categoryL1,categoryL2:r.value.categoryL2,categoryL3:r.value.categoryL3,categoryL4:r.value.categoryL4,priceRange:r.value.priceRange,style_features:r.value.style_features},is_async:!1};console.log("发送请求:",t);const e=await fetch(gt,{method:"POST",headers:{Authorization:`Bearer ${yt}`,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(t)});if(!e.ok){const i=await e.json();throw new Error(i.message||"分析请求失败")}const o=await e.json();if(console.log("收到响应:",o),o.error)throw new Error(o.error.message||"分析过程出现错误");o.data&&(n.value=o.data,w.value&&w.value.scrollIntoView({behavior:"smooth"})),await A("trend",n.value)}catch(t){console.error("分析错误:",t),T.value=t.message,n.value=`分析失败: ${t.message}`}finally{f.value=!1}},w=l(null),N=P(()=>new Date().toLocaleString("zh-CN")),D=l(["简约","时尚","休闲"]);l(""),S(D,s=>{r.value.style_features=s.join(",")},{deep:!0});const I=()=>{if(!n.value)return;const s=new Blob([n.value],{type:"text/plain;charset=utf-8"}),t=document.createElement("a");t.href=URL.createObjectURL(s),t.download=`趋势分析报告_${new Date().toLocaleString()}.txt`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(t.href)},V=async()=>{try{const s=window.location.href;await navigator.clipboard.writeText(s),alert("链接已复制到剪贴板")}catch(s){console.error("复制失败:",s),alert("复制链接失败,请手动复制")}},W=P(()=>{if(!n.value)return[];try{const s=typeof n.value=="string"?JSON.parse(n.value):n.value;if(!s.data)return[];const t=s.data.trimStart();return[`<div>${U(t)}</div>`]}catch(s){return console.error("处理分析结果时出错:",s),[]}});function B(s){return s.split(/## |### /gm).reduce((t,e)=>{const o=e.split(`
`).filter(u=>u.trim());if(!o.length)return t;if(e.startsWith("抖音平台")||e.startsWith("淘系平台")||e.startsWith("小红书"))return t.push({platform:o[0].trim(),categories:[]}),t;t.length===0&&t.push({platform:"平台分析",categories:[]});const i=t[t.length-1];if(e.startsWith("抖音")||e.startsWith("淘系")||e.startsWith("小红书品类")){const u={rank:o[0].trim()};o.slice(1).forEach(v=>{const b=v.trim();if(b.startsWith("- **")){const[m,...L]=b.split(/：/),F=m.replace(/^- \*\*|\*\*/g,"").trim(),H=L.join(":").trim();u[F]=H}else b.startsWith("**结论**：")&&(u.结论=b.replace("**结论**：","").trim())}),i.categories.push(u)}return t},[])}function U(s){const t=B(s);let e="";return t.forEach(({platform:o,categories:i})=>{if(!i.length)return;e+=`<h2 class="platform-title">${o}</h2>`,e+='<table class="data-table" border="1" cellspacing="0" cellpadding="0">';const u=Object.keys(i[0]).filter(v=>v!=="rank");e+="<thead><tr>",u.forEach(v=>{e+=`<th>${v}</th>`}),e+="</tr></thead>",e+="<tbody>",i.forEach(v=>{e+="<tr>",u.forEach(b=>{const m=v[b]||"—",L=typeof m=="string"&&(m.includes("%")||/^\d+[,\.]\d+$/.test(m))?"number":"";e+=`<td class="${L}">${m}</td>`}),e+="</tr>"}),e+="</tbody>",e+="</table>"}),e}const A=async(s,t)=>{try{if(!t||t.trim()===""){console.error("保存记录失败: 结果为空");return}const e=await fetch("http://localhost:3000/api/save-record",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pageType:s,categoryL1:r.value.categoryL1,categoryL2:r.value.categoryL2,priceRange:r.value.priceRange,result:t.toString()})});if(console.log("保存记录响应状态:",e.status,e.statusText),!e.ok){const i=await e.text();throw console.error("保存记录失败响应内容:",i),new Error(`保存记录失败: ${e.status}`)}const o=await e.json();console.log("记录保存成功:",o)}catch(e){console.error("保存记录出错:",e),alert(`保存记录失败: ${e.message}`)}},p=l(null),y=l(""),_=l(!1),C=s=>{p.value=s},z=async()=>{try{console.log("提交反馈:",{type:p.value,comment:y.value,pageType:"trend",timestamp:new Date().toISOString()}),await new Promise(s=>setTimeout(s,500)),_.value=!0,setTimeout(()=>{p.value=null,y.value="",_.value=!1},3e3)}catch(s){console.error("提交反馈失败:",s)}};return(s,t)=>(d(),c("div",Y,[M(Z),t[12]||(t[12]=x('<div class="animated-background" data-v-2ed7b997><div class="fashion-icon" data-v-2ed7b997><i class="fas fa-tshirt" data-v-2ed7b997></i></div><div class="fashion-icon" data-v-2ed7b997><i class="fas fa-hat-cowboy" data-v-2ed7b997></i></div><div class="fashion-icon" data-v-2ed7b997><i class="fas fa-socks" data-v-2ed7b997></i></div><div class="fashion-icon" data-v-2ed7b997><i class="fas fa-shoe-prints" data-v-2ed7b997></i></div><div class="fashion-icon" data-v-2ed7b997><i class="fas fa-glasses" data-v-2ed7b997></i></div></div>',1)),a("div",G,[t[11]||(t[11]=a("header",null,[a("div",{class:"brand-name"}," PickPro—智选专家 "),a("p",{class:"subtitle animated-text"},[a("span",{class:"glowing-white-text"},"【品类趋势先知】")])],-1)),a("div",tt,[a("div",et,[t[3]||(t[3]=x('<div class="parameter-grid" data-v-2ed7b997><div class="robot-image-container" data-v-2ed7b997><i class="fas fa-robot robot-icon" data-v-2ed7b997></i><div class="robot-text" data-v-2ed7b997><p class="robot-title" data-v-2ed7b997>PickPro</p><p class="robot-description" data-v-2ed7b997>从Z世代消费密码到碳中和面料革命，实时捕捉全球秀场/社交媒体/竞品动态</p><p class="robot-status" data-v-2ed7b997>AI算法正在解析超80个市场主流品类......</p></div></div></div>',1)),a("div",at,[a("button",{type:"submit",class:"submit-btn",onClick:E,disabled:f.value},[f.value?(d(),c("i",ot)):h("",!0),g(" "+R(f.value?"分析中...":"开始分析"),1)],8,st)])]),a("div",rt,[n.value?(d(),c("div",lt,[a("div",it,[a("div",ct,[t[5]||(t[5]=a("h3",null,"分析报告",-1)),a("span",dt,R(N.value),1)]),a("div",{class:"action-buttons"},[a("button",{class:"action-btn",onClick:I},t[6]||(t[6]=[a("i",{class:"fas fa-download"},null,-1),g(" 导出报告 ")])),a("button",{class:"action-btn",onClick:V},t[7]||(t[7]=[a("i",{class:"fas fa-share-alt"},null,-1),g(" 分享 ")]))])]),a("div",{class:"output-content",ref_key:"outputBox",ref:w},[(d(!0),c(q,null,K(W.value,(e,o)=>(d(),c("div",{key:o,innerHTML:e},null,8,ut))),128))],512),n.value?(d(),c("div",vt,[a("div",ft,[t[10]||(t[10]=g(" 您对分析结果的评价如何？ ")),a("div",pt,[a("button",{class:j(["feedback-btn like-btn",{active:p.value==="like"}]),onClick:t[0]||(t[0]=e=>C("like"))},t[8]||(t[8]=[a("i",{class:"fas fa-thumbs-up"},null,-1),g(" 有帮助 ")]),2),a("button",{class:j(["feedback-btn dislike-btn",{active:p.value==="dislike"}]),onClick:t[1]||(t[1]=e=>C("dislike"))},t[9]||(t[9]=[a("i",{class:"fas fa-thumbs-down"},null,-1),g(" 不满意 ")]),2)])]),p.value?(d(),c("div",bt,[Q(a("textarea",{"onUpdate:modelValue":t[2]||(t[2]=e=>y.value=e),placeholder:"请告诉我们您的具体建议（选填）",rows:"2"},null,512),[[X,y.value]]),a("button",{class:"submit-comment-btn",onClick:z},"提交")])):h("",!0),_.value?(d(),c("div",mt," 感谢您的反馈！我们将不断改进分析质量。 ")):h("",!0)])):h("",!0)])):(d(),c("div",nt,t[4]||(t[4]=[a("i",{class:"fas fa-chart-pie"},null,-1),a("p",null,"请点击开始分析按钮",-1)])))])])]),t[13]||(t[13]=x('<div class="decoration-elements" data-v-2ed7b997><div class="floating-element" style="--delay:0s;" data-v-2ed7b997><i class="fas fa-chart-line" data-v-2ed7b997></i></div><div class="floating-element" style="--delay:2s;" data-v-2ed7b997><i class="fas fa-tags" data-v-2ed7b997></i></div><div class="floating-element" style="--delay:4s;" data-v-2ed7b997><i class="fas fa-shopping-bag" data-v-2ed7b997></i></div></div>',1))]))}},Lt=J(ht,[["__scopeId","data-v-2ed7b997"]]);export{Lt as default};
