import{_ as ee,r as u,j as E,k as U,c as i,h as te,b as j,a as t,d as p,l as k,m as $,F as O,e as P,v as N,p as ae,f as C,t as T,n as F,o as r}from"./index-BvQQ6c71.js";import{F as se}from"./FeatureSidebar-BUypuvcV.js";const oe={class:"decode-page"},le={class:"container"},ne={class:"main-content"},ie={class:"parameter-panel"},re={class:"parameter-grid"},ce={class:"parameter-item"},de={class:"parameter-item"},ue=["value"],ve={class:"parameter-item"},pe={class:"param-group"},fe={class:"param-item"},me={class:"style-input"},be={class:"style-tags"},ye=["onClick"],ge={class:"form-actions"},he=["disabled"],ke={key:0,class:"fas fa-spinner fa-spin"},we={class:"result-content"},Le={key:0,class:"placeholder-text"},_e={key:1,class:"analysis-output"},Ce={class:"output-header"},Te={class:"header-left"},xe={class:"timestamp"},Se=["innerHTML"],Re={key:0,class:"feedback-section"},je={class:"feedback-title"},$e={class:"feedback-buttons"},Oe={key:0,class:"feedback-comment"},Pe={key:1,class:"feedback-thanks"},Ve="https://api.coze.cn/v1/workflow/run",De="pat_hWPutau3CRQrAOS48iXuQH0aDsIriuczPJkZKuSPejqq0X2w1I1xU4VtxeeKio2a",Ee={__name:"DecodeView",setup(Ue){const o=u({categoryL1:"",categoryL2:"",categoryL3:"",categoryL4:"",priceRange:"",style_features:""}),A=["风衣","汉服","牛仔裤","皮草","皮衣","时尚套装","休闲裤","休闲运动套装","秀禾服","羽绒服","Polo衫","T恤","背心","衬衫","大码上装","大码下装","短裤","短外套","防晒服","工装制服","夹克","马甲","毛呢大衣","棉裤","棉衣","牛仔衬衫","牛仔外套","皮裤","商务正装西服","设计师/潮牌男装","时尚防晒服","唐装","卫裤","卫衣","西服","西裤","休闲西服","羊毛衫","羊绒背心","羊绒开衫","羊绒衫","羊绒套衫","羽绒裤","羽绒马甲","针织衫","中老年上装","中老年套装","中老年下装","中山装"],B=["POLO衫","T恤","半身裙","背心吊带","衬衫","短外套","风衣","连衣裙","毛衣","毛针织衫","牛仔裤","派克服","皮衣","时尚防晒服","卫裤","休闲裤","羊绒衫","羽绒服","中老年女装","打底裤","大码连衣裙","大码女装","汉服","蕾丝衫/雪纺衫","马夹","毛呢外套","棉衣/棉服","抹胸","皮草","旗袍","时尚套装","唐装/中式服装裙子","唐装/中式服装上衣","卫衣/绒衫","西装","休闲运动套装","秀禾服","打底服","大码衬衫","大码牛仔裤","大衣","短裤","礼服_晚装","连体衣/裤","连体衣裤","马甲","棉裤/羽绒裤","棉衣_棉服","设计师/潮牌女装","天然皮草","卫衣_绒衫","西服","西服套装","西装裤/正装裤","羊毛衫","羊绒大衣","真丝上装"],w=u([]);E(()=>o.value.categoryL1,s=>{o.value.categoryL2="",s==="男装"?w.value=A:s==="女装"?w.value=B:w.value=[]});const f=u(!1),c=u(""),V=u(null),I=async s=>{if(!f.value)try{f.value=!0,V.value=null,c.value="正在分析中...";const e={workflow_id:"7475252200421376011",parameters:{categoryL1:o.value.categoryL1,categoryL2:o.value.categoryL2,categoryL3:o.value.categoryL3,categoryL4:o.value.categoryL4,priceRange:o.value.priceRange,style_features:o.value.style_features},is_async:!1};console.log("发送请求:",e);const a=await fetch(Ve,{method:"POST",headers:{Authorization:`Bearer ${De}`,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e)});if(!a.ok){const b=await a.json();throw new Error(b.message||"分析请求失败")}const l=await a.json();if(console.log("收到响应:",l),l.error)throw new Error(l.error.message||"分析过程出现错误");l.data&&(c.value=l.data,x.value&&x.value.scrollIntoView({behavior:"smooth"})),await X("decode",c.value)}catch(e){console.error("分析错误:",e),V.value=e.message,c.value=`分析失败: ${e.message}`}finally{f.value=!1}},x=u(null),z=U(()=>new Date().toLocaleString("zh-CN")),L=u(["简约","时尚","休闲"]),y=u(""),K=()=>{y.value.trim()&&(L.value.push(y.value.trim()),y.value="")},M=s=>{L.value.splice(s,1)};E(L,s=>{o.value.style_features=s.join(",")},{deep:!0});const H=()=>{if(!c.value)return;const s=new Blob([c.value],{type:"text/plain;charset=utf-8"}),e=document.createElement("a");e.href=URL.createObjectURL(s),e.download=`趋势分析报告_${new Date().toLocaleString()}.txt`,document.body.appendChild(e),e.click(),document.body.removeChild(e),URL.revokeObjectURL(e.href)},J=async()=>{try{const s=window.location.href;await navigator.clipboard.writeText(s),alert("链接已复制到剪贴板")}catch(s){console.error("复制失败:",s),alert("复制链接失败,请手动复制")}},W=U(()=>{if(!c.value)return[];try{const s=typeof c.value=="string"?JSON.parse(c.value):c.value;if(!s.data)return[];const e=s.data.trimStart();return[`<div>${Q(e)}</div>`]}catch(s){return console.error("处理分析结果时出错:",s),[]}});function q(s){return s.split(/### /).slice(1).map(a=>{const l=a.split(`
`).filter(v=>v.trim()),g=l[0].replace("商品特征","").trim(),n=[];let d={};return l.slice(1).forEach(v=>{v.startsWith("- **商品名称**")?(Object.keys(d).length&&n.push(d),d={name:v.split("：")[1].trim(),features:{}}):v.startsWith("- **商品价格**")?d.price=parseFloat(v.split("：")[1]):v.startsWith("- **商品特征**")&&v.split("：")[1].split(" | ").map(R=>{const h=R.split(":"),Z=h[0].trim(),G=h.length>1?h.slice(1).join(":").trim():"";return{key:Z,value:G}}).forEach(({key:R,value:h})=>{d.features[R]=h})}),Object.keys(d).length&&n.push(d),{platform:g,products:n}})}function Q(s){const e=q(s);let a="";return e.forEach(({platform:l,products:b})=>{a+='<div class="platform-section">',a+=`<h2>${l}</h2>`,a+='<table class="feature-table" border="1" cellspacing="0" cellpadding="0">';const g=new Set;b.forEach(n=>{Object.keys(n.features).forEach(d=>g.add(d))}),a+=`<thead><tr>
      <th>商品名称</th>
      <th>价格</th>
      ${Array.from(g).map(n=>`<th>${n}</th>`).join("")}
    </tr></thead><tbody>`,b.forEach(n=>{a+=`<tr>
        <td>${n.name}</td>
        <td class="price-highlight">¥${n.price?n.price.toFixed(1):"未知"}</td>
        ${Array.from(g).map(d=>`
          <td>${n.features[d]?n.features[d].split(/，|、/).map(v=>`<span class="spec-tag">${v}</span>`).join(""):'<span class="unknown-spec">未提及</span>'}
          </td>`).join("")}
      </tr>`}),a+="</tbody></table></div>"}),a}const X=async(s,e)=>{try{(await fetch("http://localhost:3000/api/save-record",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pageType:s,categoryL1:o.value.categoryL1,categoryL2:o.value.categoryL2,priceRange:o.value.priceRange,result:e})})).ok||console.error("保存记录失败")}catch(a){console.error("保存记录出错:",a)}},m=u(null),_=u(""),S=u(!1),D=s=>{m.value=s},Y=async()=>{try{console.log("提交反馈:",{type:m.value,comment:_.value,pageType:"decode",timestamp:new Date().toISOString()}),await new Promise(s=>setTimeout(s,500)),S.value=!0,setTimeout(()=>{m.value=null,_.value="",S.value=!1},3e3)}catch(s){console.error("提交反馈失败:",s)}};return(s,e)=>(r(),i("div",oe,[te(se),e[23]||(e[23]=j('<div class="animated-background" data-v-3176ab76><div class="fashion-icon" data-v-3176ab76><i class="fas fa-tshirt" data-v-3176ab76></i></div><div class="fashion-icon" data-v-3176ab76><i class="fas fa-hat-cowboy" data-v-3176ab76></i></div><div class="fashion-icon" data-v-3176ab76><i class="fas fa-socks" data-v-3176ab76></i></div><div class="fashion-icon" data-v-3176ab76><i class="fas fa-shoe-prints" data-v-3176ab76></i></div><div class="fashion-icon" data-v-3176ab76><i class="fas fa-glasses" data-v-3176ab76></i></div></div>',1)),t("div",le,[e[22]||(e[22]=t("header",null,[t("div",{class:"brand-name"}," PickPro—智选专家 "),t("p",{class:"subtitle animated-text"},[t("span",{class:"glowing-white-text"},"【爆品风尚解码】")])],-1)),t("div",ne,[t("div",ie,[e[14]||(e[14]=t("h2",null,[t("i",{class:"fas fa-sliders"}),p(" 选品参数设置")],-1)),t("div",re,[t("div",ce,[e[8]||(e[8]=t("label",null,"服装一级类目",-1)),k(t("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>o.value.categoryL1=a)},e[7]||(e[7]=[t("option",{value:""},"请选择",-1),t("option",{value:"女装"},"女装",-1),t("option",{value:"男装"},"男装",-1)]),512),[[$,o.value.categoryL1]])]),t("div",de,[e[10]||(e[10]=t("label",null,"服装二级类目",-1)),k(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>o.value.categoryL2=a)},[e[9]||(e[9]=t("option",{value:""},"请选择",-1)),(r(!0),i(O,null,P(w.value,a=>(r(),i("option",{key:a,value:a},T(a),9,ue))),128))],512),[[$,o.value.categoryL2]])]),t("div",ve,[e[12]||(e[12]=t("label",null,"价格带",-1)),k(t("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.priceRange=a)},e[11]||(e[11]=[j('<option value="" data-v-3176ab76>请选择</option><option value="0-50" data-v-3176ab76>0-50元</option><option value="50-100" data-v-3176ab76>50-100元</option><option value="100-200" data-v-3176ab76>100-200元</option><option value="200-500" data-v-3176ab76>200-500元</option><option value="500-1000" data-v-3176ab76>500-1000元</option><option value="1000-inf" data-v-3176ab76>1000元以上</option>',7)]),512),[[$,o.value.priceRange]])]),t("div",pe,[t("div",fe,[e[13]||(e[13]=t("label",null,"风格特色",-1)),t("div",me,[t("div",be,[(r(!0),i(O,null,P(L.value,(a,l)=>(r(),i("span",{key:l,class:"style-tag"},[p(T(a)+" ",1),t("i",{class:"fas fa-times",onClick:b=>M(l)},null,8,ye)]))),128))]),k(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>y.value=a),onKeyup:ae(K,["enter"]),type:"text",placeholder:"输入风格特色并按回车添加",class:"style-tag-input"},null,544),[[N,y.value]])])])])]),t("div",ge,[t("button",{type:"submit",class:"submit-btn",onClick:I,disabled:f.value},[f.value?(r(),i("i",ke)):C("",!0),p(" "+T(f.value?"分析中...":"开始分析"),1)],8,he)])]),t("div",we,[c.value?(r(),i("div",_e,[t("div",Ce,[t("div",Te,[e[16]||(e[16]=t("h3",null,"分析报告",-1)),t("span",xe,T(z.value),1)]),t("div",{class:"action-buttons"},[t("button",{class:"action-btn",onClick:H},e[17]||(e[17]=[t("i",{class:"fas fa-download"},null,-1),p(" 导出报告 ")])),t("button",{class:"action-btn",onClick:J},e[18]||(e[18]=[t("i",{class:"fas fa-share-alt"},null,-1),p(" 分享 ")]))])]),t("div",{class:"output-content",ref_key:"outputBox",ref:x},[(r(!0),i(O,null,P(W.value,(a,l)=>(r(),i("div",{key:l,innerHTML:a},null,8,Se))),128))],512),c.value?(r(),i("div",Re,[t("div",je,[e[21]||(e[21]=p("您对分析结果的评价如何？ ")),t("div",$e,[t("button",{class:F(["feedback-btn like-btn",{active:m.value==="like"}]),onClick:e[4]||(e[4]=a=>D("like"))},e[19]||(e[19]=[t("i",{class:"fas fa-thumbs-up"},null,-1),p(" 有帮助 ")]),2),t("button",{class:F(["feedback-btn dislike-btn",{active:m.value==="dislike"}]),onClick:e[5]||(e[5]=a=>D("dislike"))},e[20]||(e[20]=[t("i",{class:"fas fa-thumbs-down"},null,-1),p(" 不满意 ")]),2)])]),m.value?(r(),i("div",Oe,[k(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=a=>_.value=a),placeholder:"请告诉我们您的具体建议（选填）",rows:"2"},null,512),[[N,_.value]]),t("button",{class:"submit-comment-btn",onClick:Y},"提交")])):C("",!0),S.value?(r(),i("div",Pe," 感谢您的反馈！我们将不断改进分析质量。 ")):C("",!0)])):C("",!0)])):(r(),i("div",Le,e[15]||(e[15]=[t("i",{class:"fas fa-chart-pie"},null,-1),t("p",null,"请设置选品参数开始分析",-1)])))])])]),e[24]||(e[24]=j('<div class="decoration-elements" data-v-3176ab76><div class="floating-element" style="--delay:0s;" data-v-3176ab76><i class="fas fa-chart-line" data-v-3176ab76></i></div><div class="floating-element" style="--delay:2s;" data-v-3176ab76><i class="fas fa-tags" data-v-3176ab76></i></div><div class="floating-element" style="--delay:4s;" data-v-3176ab76><i class="fas fa-shopping-bag" data-v-3176ab76></i></div></div>',1))]))}},Ie=ee(Ee,[["__scopeId","data-v-3176ab76"]]);export{Ie as default};
